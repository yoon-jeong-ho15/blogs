---
title: 로직 리팩토링 (전투,레벨업 로직)
index: 3
date: 2025-10-10
tags:
  - 리팩토링
  - pkmon
---
# 리팩토링 내용
## 요약
- 전투 로직 분리 : `BattleField.tsx` -> `battle.ts` 
- 레벨업 로직 분리 : `useGameStore.ts` -> `battle.ts`
- storage 추상화 계층 추가 : `storage.ts` 파일 추가 (다른 글에서 다룬다)
- encounter 의존성 주입 : `encounter.ts` (다른 글에서 다룬다)

## 전투 로직 분리

`BattleField` 컴포넌트 안의 전투 로직을 따로 분리했다. (UI렌더링과 비즈니스로직의 관심사 분리)

## 레벨업 로직 분리

`useGameStore`의 *Store Action* (상태를 변경하는 함수) 안에 따로 순수 함수로 분리될 수 있는 로직이 있었다.

```ts
addExpToLeadPkmon: (exp) =>
  set((state) => {
    // 레벨업 로직이 action 안에 포함 (30줄+)
    const newLevel = getLevelFromExp(newExp);
    if (newLevel > oldLevel) {
      const species = PKMON_SPECIES.find(...);
      const levelDiff = newLevel - oldLevel;
      // 복잡한 스탯 계산...
    }
  })
```

1. 현재 경험치를 기준으로 새로운 레벨을 구하고 
2. 레벨이 올랐다면 능력치를 더해준다.
이 기능을 그대로 `battle.ts`에 작성하고 불러와서 사용.

